# shared-postgresql-compose.yml
name: shared-postgresql-dev # Um nome descritivo para o projeto Docker Compose

services:
  postgresql:
    image: postgres:16.3
    environment:
      # Define um usuário com privilégios de superusuário para esta instância PostgreSQL.
      # Ambas as aplicações usarão essas credenciais para conectar e, se necessário, criar seus próprios bancos de dados.
      - POSTGRES_USER=devuser
      - POSTGRES_PASSWORD=devpassword
      # Este é o nome de um banco de dados padrão que será criado automaticamente
      # e ao qual o 'devuser' terá acesso. Suas aplicações se conectarão a bancos de dados específicos
      # (ex: bgls_db, fairmaster_db) dentro desta instância.
      - POSTGRES_DB=dev_default_db
      # 'trust' permite conexões sem senha de dentro da rede Docker.
      # No entanto, como você está expondo para 127.0.0.1, as aplicações que se conectam via
      # 127.0.0.1:5432 usarão as credenciais definidas acima (POSTGRES_USER e POSTGRES_PASSWORD).
      # IMPORTANTE: Em produção, o POSTGRES_HOST_AUTH_METHOD deve ser configurado de forma mais segura.
      - POSTGRES_HOST_AUTH_METHOD=trust
    volumes:
      # ESSENCIAL: Isso monta um diretório local chamado 'pg_data' (relativo ao local deste arquivo docker-compose)
      # para o diretório de dados do PostgreSQL dentro do container.
      # Isso garante que seus dados persistem mesmo se o container for removido ou recriado.
      - ./pg_data:/var/lib/postgresql/data/
    healthcheck:
      # Verifica se o banco de dados está pronto para aceitar conexões
      test: ['CMD-SHELL', 'pg_isready -U $${POSTGRES_USER} -d $${POSTGRES_DB}']
      interval: 5s
      timeout: 5s
      retries: 10
    ports:
      # Expõe a porta 5432 do container para a porta 5432 da sua máquina local (127.0.0.1).
      # Apenas UMA instância PostgreSQL pode se ligar a esta porta por vez.
      - 127.0.0.1:5432:5432
